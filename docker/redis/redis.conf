# Redis Configuration for StayAfrica
# Security-hardened configuration

# Allow connections from Docker network
# Do not bind to localhost only - allow Docker network connections
# bind 127.0.0.1 ::1  # Don't use this in Docker - prevents inter-container communication

# Protected mode - clients must authenticate
protected-mode yes

# Require password authentication
# This will be overridden by REDIS_PASSWORD environment variable
requirepass changeme

# Disable dangerous commands
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG ""
rename-command SHUTDOWN ""
rename-command DEBUG ""

# Enable AOF persistence for data durability
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec

# Memory management
maxmemory 256mb
maxmemory-policy allkeys-lru

# Logging
loglevel notice

# Slow log - log queries slower than 10ms
slowlog-log-slower-than 10000
slowlog-max-len 128

# Disable TCP keepalive to reduce overhead
tcp-keepalive 300

# Maximum number of connected clients
maxclients 10000

# Disable RDB snapshots (we use AOF)
save ""

# Security: Disable Lua scripting timeout
lua-time-limit 5000
